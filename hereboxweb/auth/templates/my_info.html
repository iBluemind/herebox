{% extends "index_logged_in.html" %}
{% block my_index_body %}

    <form class="my-info-form form-horizontal">
        <div class="form-group col-xs-12">
            <label for="inputName" class="col-xs-4 control-label">이름</label>
            <div class="col-xs-8" style="padding-right: 0;">
                <input type="text" class="form-control" id="inputName" placeholder="이름을 입력해주세요">
            </div>
        </div>
        <div class="form-group col-xs-12">
            <label for="inputEmail" class="col-xs-4 control-label">이메일 주소</label>
            <div class="col-xs-8" style="padding-right: 0;">
                <input type="email" class="form-control" id="inputEmail" placeholder="이메일 주소를 입력해주세요">
            </div>
        </div>
        <div class="form-group col-xs-12">
            <label for="inputPassword" class="col-xs-4 control-label">새 비밀번호</label>
            <div class="col-xs-8" style="padding-right: 0;">
                <input type="password" class="form-control" id="inputPassword" placeholder="비밀번호 변경을 원하시면 입력하세요">
            </div>
        </div>
        <div class="form-group col-xs-12">
            <label for="inputPasswordCheck" class="col-xs-4 control-label">새 비밀번호 확인</label>
            <div class="col-xs-8" style="padding-right: 0;">
                <input type="password" class="form-control" id="inputPasswordCheck" placeholder="비밀번호 변경을 원하시면 입력하세요">
            </div>
        </div>
        <div class="form-group col-xs-12">
            <label for="inputAddress" class="col-xs-4 control-label">주소</label>
            <div class="col-xs-8" style="padding-right: 0;">
                <input type="text" class="form-control" id="inputAddress" placeholder="주소를 입력해주세요">
            </div>
        </div>
        <div class="form-group col-xs-12">
            <label for="inputAddressDetail" class="col-xs-4 control-label">상세주소</label>
            <div class="col-xs-8" style="padding-right: 0;">
                <input type="text" class="form-control" id="inputAddressDetail" placeholder="상세주소를 입력해주세요">
            </div>
        </div>
        <div class="form-group col-xs-12">
            <label for="inputPhone" class="col-xs-4 control-label">핸드폰 번호</label>
            <div class="col-xs-6" style="padding-right: 5px;">
                <input id="inputNewPhone" type="tel" class="form-control" placeholder="핸드폰 번호를 입력해주세요">
            </div>
            <button type="button" id="btnAuthCode" class="col-xs-2 btn btn-hbprimary" style="padding: 10px 16px;">인증번호 받기</button>
        </div>
        <div class="form-group col-xs-12">
            <label for="inputCode" class="col-xs-4 control-label"></label>
            <div class="col-xs-6" style="padding-right: 5px;">
                <input type="text" class="form-control" id="inputCode" placeholder="인증번호를 입력하세요">
            </div>
            <button id="btnAuthCodeCheck" type="button" class="col-xs-2 btn btn-hbprimary" style="padding: 10px 16px;">확인</button>
        </div>

        <button type="submit" class="btn btn-hbprimary" style="margin: 100px 0 100px;">수정하기</button>
    </form>

{% endblock %}
{% block jscript %}

    <script>

        $(document).ready(function () {
            var isBtnAuthCode = false;

            $("#btnAuthCode").click(function () {

                var newUserPhone = $("#inputNewPhone").val();
                var phoneRegex = /^([0]{1}[1]{1}[016789]{1})([0-9]{3,4})([0-9]{4})$/;
                if (!phoneRegex.test(newUserPhone)) {
                    alert("핸드폰 번호를 하이픈(-) 없이 입력해주세요.");
                    return ;
                }

                $.ajax({
                     type: "POST",
                     url: "/authentication_code",
                     data: {phone: newUserPhone
                     },
                     success: function () {
                        alert("인증번호를 발송했습니다.");
                        isBtnAuthCode = true;
                     },
                     error: function(request, status, error) {
                        var parsedBody = $.parseJSON(request.responseText);
                        alert(parsedBody['message']);
                     }
                });
            });

            $("#btnAuthCodeCheck").click(function () {
                if (!isBtnAuthCode) {
                    alert("인증번호 받기 버튼을 먼저 눌러주세요.");
                    return ;
                }

                var userAuthCode = $("#inputCode").val();
                var authCodeRegex = /^([0-9]{4})$/;
                if (!authCodeRegex.test(userAuthCode)) {
                    alert("올바른 인증코드를 입력해주세요.");
                    return ;
                }

                $.ajax({
                     type: "GET",
                     url: "/authentication_code",
                     data: {authCode: userAuthCode
                     },
                     success: function () {
                        alert("인증에 성공했습니다.");
                     },
                     error: function(request, status, error) {
                        var parsedBody = $.parseJSON(request.responseText);
                        alert(parsedBody['message']);
                     }
                });
            });
        });

    </script>

{% endblock %}